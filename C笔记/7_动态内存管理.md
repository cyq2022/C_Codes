指针

结构体

动态内存管理





# malloc()

![image-20231102151005284](assets/image-20231102151005284.png)



头文件 `stdlib.h`



申请一块内存

开辟失败返回空指针

参数 是 字节数





对函数返回值验证是否空指针后使用







在堆区申请

程序退出后 系统自动回收内存空间



内存泄漏： 丢失可用内存



![image-20231102152008890](assets/image-20231102152008890.png)



# free()



![image-20231102152630696](assets/image-20231102152630696.png)

释放指针指向的内存；



释放完后指针 应置空； 比较危险

```c
free(p);
    p = null;
```



![image-20231102153010631](assets/image-20231102153010631.png)

![image-20231102153129229](assets/image-20231102153129229.png)







# calloc()

开辟好后内容初始化 赋 0 

![image-20231102153635056](assets/image-20231102153635056.png)

![image-20231102153611453](assets/image-20231102153611453.png)







# realloc()

![image-20231102153836461](assets/image-20231102153858223.png)

![image-20231102154422415](assets/image-20231102154422415.png)





扩容 空间不够时 ，开辟 后 复制 ， 释放旧空间；



可能返回 新的指针  

扩容失败 返回空指针



一般使用新的指针接受返回值  







# 常见错误

![image-20231102163537501](assets/image-20231102163537501.png)



越界

![image-20231102163626592](assets/image-20231102163626592.png)





3![image-20231102163647277](assets/image-20231102163647277.png)





4

free 释放动态开辟内存一部分 不可以

![image-20231102164418571](assets/image-20231102164418571.png)







5

![image-20231102164736155](../../image-20231102164736155.png)





6

![image-20231102164841840](assets/image-20231102164841840.png)

flag == 5  内存泄漏







# 笔试题

返回栈空间地址的问题

栈空间销毁

![image-20231102165837177](assets/image-20231102165837177.png)



传空指针， 传值  ， str 是空指针

p 指向 一块空间  调用完p销毁， 空间没有释放， 

 

修改后 二级指针

![image-20231102170232128](assets/image-20231102170232128.png) 	





补充

![image-20231102170509319](assets/image-20231102170509319.png)

字符串 首地址， 传给printf()；





# 内存区的分布

![image-20231102184921947](assets/image-20231102184921947.png)

![image-20231102185013112](assets/image-20231102185013112.png)







# 柔性数组

![image-20231102185546914](assets/image-20231102185546914.png)

结构体最后一个成员

![image-20231102185659054](assets/image-20231102185659054.png)







## 定义

![image-20231102185858675](assets/image-20231102185858675.png)



sizeof结构体大小 不包含 柔性数组内存



使用 ： malloc（） 给结构体分配内存  大于结构大小

![image-20231102190410930](assets/image-20231102190410930.png)

realloc() 扩容 ； 

free 释放空间









方式二  ： malloc 给 结构体空间  

​				malloc 给  数组空间



![image-20231102191432168](assets/image-20231102191432168.png)

![image-20231102191445606](assets/image-20231102191445606.png)





![image-20231102191528205](assets/image-20231102191528205.png)



方法1   直接结构体扩容

方法2  arr扩容







![image-20231102191716106](assets/image-20231102191716106.png)